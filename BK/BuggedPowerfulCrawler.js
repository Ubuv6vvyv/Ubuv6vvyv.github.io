!function(){let e={maxDepth:3,maxConcurrentRequests:5,rateLimitDelay:100,thumbnailSize:50,mediaExtensions:[".jpg",".jpeg",".png",".gif",".webp",".mp4",".webm",".ogg",".mp3",".wav",".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx"]},t={visited:new Set,baseUrl:new URL(window.location.href),activeRequests:0,isPaused:!1,totalLinks:0,processedLinks:0,filterKeyword:"",sitemap:{},uniqueLinks:new Set,uniqueMedia:new Set,stats:{totalBytes:0,mimeTypes:{}}};async function a(e,t=1e4){let a=new AbortController,n=setTimeout(()=>a.abort(),t);try{let i=await fetch(e,{method:"GET",signal:a.signal});return clearTimeout(n),i.ok?await i.text():(o(`HTTP error! Status: ${i.status}`),null)}catch(l){return o(`Failed to fetch ${e}: ${l.message}`),null}}function r(e,t){try{let a=e.trim().replace(/^["']|["']$/g,"");return a=decodeURIComponent(encodeURIComponent(a)),new URL(a,t).href}catch{return null}}function n(a,n){let i=new Set,l=new Set,s=e=>{try{return e?r(e,n):null}catch{return null}};const d=t=>{if(!t||!t.querySelectorAll)return;t.querySelectorAll("a,img,video,audio,source,link[rel='stylesheet'],script").forEach(e=>{let t=s(e.href||e.src||e.srcset?.split(" ")[0]||"");t&&("A"===e.tagName?i.add(t):l.add(t))});const a=[/https?:\/\/[\w\-.]+(\.s3\.[\w\-]+\.amazonaws\.com\/[^"'\s)]+)/gi,/(?:url\(|src=["']|href=["'])(https?:\/\/[^"')]+)/gi,/data-[^=]+=["'](https?:\/\/[^"']+)["']/gi];let o=t.innerHTML||"";a.forEach(t=>{let a;while((a=t.exec(o))!==null){const t=s(a[1]||a[0]);t&&(e.mediaExtensions.some(e=>t.toLowerCase().includes(e))?l.add(t):i.add(t))}})};return d(a),Array.from(a.querySelectorAll("iframe")).forEach(e=>{try{e.contentDocument&&d(e.contentDocument)}catch{}}),{links:Array.from(i),media:Array.from(l)}}function i(t){return e.mediaExtensions.some(e=>t.toLowerCase().endsWith(e))}async function l(r,s=0){if(s>e.maxDepth||t.visited.has(r))return;for(;t.isPaused;)await new Promise(e=>setTimeout(e,1e3));t.visited.add(r),o(`Crawling: ${r}`);let d;if(r===window.location.href)d=document;else{for(;t.activeRequests>=e.maxConcurrentRequests;)await new Promise(e=>setTimeout(e,100));t.activeRequests++;let u=await a(r);if(t.activeRequests--,!u)return;d=new DOMParser().parseFromString(u,"text/html")}let c=d.title||"No Title",{links:m,media:h}=n(d,t.baseUrl),p=m.filter(e=>!t.uniqueLinks.has(e)),f=h.filter(e=>!t.uniqueMedia.has(e));if(p.forEach(e=>t.uniqueLinks.add(e)),f.forEach(e=>t.uniqueMedia.add(e)),t.filterKeyword&&!c.toLowerCase().includes(t.filterKeyword.toLowerCase()))return;let b=`<h3><a href="${r}" target="_blank">${c}</a> - <small>${r}</small></h3><table><tr><th>Links (${p.length})</th><th>Media (${f.length}) <button onclick="downloadAllMedia('${r}')">Download All Media</button></th></tr><tr><td><ul>${p.map(e=>`<li><a href="${e}" target="_blank">${e}</a></li>`).join("")}</ul></td><td><ul>${f.map(e=>`<li>${i(e)?`<img src="${e}" class="thumbnail" alt="Thumbnail">`:'<div class="media-icon"></div>'}<a href="${e}" target="_blank">${e}</a></li>`).join("")}</ul></td></tr></table>`;document.getElementById("crawlResults").innerHTML+=b,t.sitemap[r]={links:p,media:f},t.processedLinks++;let w=t.processedLinks/t.totalLinks*100,y=document.getElementById("progressBarFill");for(let v of(y.style.width=`${w}%`,y.textContent=`${Math.round(w)}%`,p))new URL(v).hostname===t.baseUrl.hostname&&(t.totalLinks++,await new Promise(t=>setTimeout(t,e.rateLimitDelay)),await l(v,s+1))}function o(e){let t=document.getElementById("log");t&&(t.innerHTML+=e+"<br>",t.scrollTop=t.scrollHeight),console.log(e)}async function u(e){try{let a=await fetch(e),n=await a.blob(),i=a.headers.get("content-type")||"unknown",l=n.size;return t.stats.totalBytes+=l,t.stats.mimeTypes[i]=(t.stats.mimeTypes[i]||0)+1,{blob:n,mimeType:i,size:l}}catch(o){throw Error(`Failed to fetch ${e}: ${o.message}`)}}window.startCrawl=async function(){let e=document.getElementById("startUrl"),a=e?e.value:t.baseUrl.href;o(`Starting crawl from ${a}`),t.baseUrl=new URL(a),t.totalLinks=1,t.processedLinks=0,t.visited.clear(),t.stats={totalBytes:0,mimeTypes:{}},document.getElementById("crawlResults").innerHTML="",await l(a),o("Crawling complete.");let n=Object.entries(t.stats.mimeTypes).sort((e,t)=>t[1]-e[1]),i=`<h3>Crawl Statistics</h3><p>Total data downloaded: ${(t.stats.totalBytes/1048576).toFixed(2)} MB</p><h4>MIME Types Distribution:</h4><ul>${n.map(([e,t])=>`<li>${e}: ${t}</li>`).join("")}</ul>`;document.getElementById("crawlResults").innerHTML+=i},window.scanCurrentPage=function(){o("Scanning current page...");let e=n(document,window.location.href),t=`<h3><a href="${window.location.href}" target="_blank">${document.title}</a> - <small>${window.location.href}</small></h3><table><tr><th>Links (${e.links.length})</th><th>Media (${e.media.length}) <button onclick="downloadAllMedia('${window.location.href}')">Download All Media</button></th></tr><tr><td><ul>${e.links.map(e=>`<li><a href="${e}" target="_blank">${e}</a></li>`).join("")}</ul></td><td><ul>${e.media.map(e=>`<li>${i(e)?`<img src="${e}" class="thumbnail" alt="Thumbnail">`:'<div class="media-icon"></div>'}<a href="${e}" target="_blank">${e}</a></li>`).join("")}</ul></td></tr></table>`;document.getElementById("crawlResults").innerHTML=t,o("Current page scan complete.")},window.togglePause=function(){t.isPaused=!t.isPaused,o(t.isPaused?"Crawl paused":"Crawl resumed")},window.setFilter=function(e){t.filterKeyword=e;let a=document.getElementById("crawlResults");if(!a)return;let n=a.getElementsByTagName("*");for(let i of n)i.textContent.toLowerCase().includes(t.filterKeyword.toLowerCase())?i.style.display="":i.style.display="none"},window.updateConfig=function(t,a){e[t]=parseInt(a,10),o(`Updated ${t} to ${a}`)},window.exportData=function(e){let a;"json"===e?a=JSON.stringify(t.sitemap,null,2):"csv"===e&&(a="Source,Target,Type\n",Object.entries(t.sitemap).forEach(([e,t])=>{t.links.forEach(t=>a+=`${e},${t},link\n`),t.media.forEach(t=>a+=`${e},${t},media\n`)}));let n=new Blob([a],{type:"json"===e?"application/json":"text/csv"}),i=window.URL.createObjectURL(n),l=document.createElement("a");l.style.display="none",l.href=i,l.download=`crawl-output.${e}`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(i)},window.downloadAllMedia=async function(e){o(`Downloading media for ${e}`);let a=t.sitemap[e]?.media||[];if(0===a.length)return void o("No media found for this page.");try{let n=new JSZip,i=n.folder("media");for(let l of a)try{let{blob:s,mimeType:d,size:c}=await u(l),m=l.split("/").pop();i.file(m,s),o(`Downloaded: ${m} (${d}, ${(c/1024).toFixed(2)} KB)`)}catch(h){o(`Failed to download ${l}: ${h.message}`)}let p=await n.generateAsync({type:"blob"}),f=URL.createObjectURL(p),b=document.createElement("a");b.href=f,b.download=`media_${e.replace(/[^a-z0-9]/gi,"_")}.zip`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(f)}catch(w){o(`Error creating zip file: ${w.message}`)}},window.analyzePage=async function(){o("Analyzing current page...");let e=document.documentElement.outerHTML,t=(new DOMParser).parseFromString(e,"text/html"),a=t.querySelectorAll("*").length,n=t.querySelectorAll("script").length,i=t.querySelectorAll("link[rel='stylesheet']").length,l=t.querySelectorAll("img").length,r=t.querySelectorAll("a").length,s=e.length,d=`<h3>Page Analysis Results</h3><ul><li>Total Elements: ${a}</li><li>Scripts: ${n}</li><li>Stylesheets: ${i}</li><li>Images: ${l}</li><li>Links: ${r}</li><li>Page Size: ${(s/1024).toFixed(2)} KB</li></ul>`;document.getElementById("analysisResults").innerHTML=d},function(){let t=document.createElement("div");t.innerHTML=`<div id="crawlerUI" style="font-family:Arial,sans-serif;padding:20px"><h2>Enhanced Web Crawler and Scraper</h2><div class="controls"><label>Starting URL: <input type="text" id="startUrl" value="${window.location.href}" style="width:100%"></label><br><button id="startCrawlBtn">Start Crawl</button> <button id="scanCurrentPageBtn">Scan Current Page</button> <button id="togglePauseBtn">Pause/Resume</button> <button id="analyzePageBtn">Analyze Page</button><label>Filter Results: <input type="text" id="filterInput" placeholder="Filter by keyword"></label><br><label>Max Depth: <input type="number" id="maxDepth" value="${e.maxDepth}" style="width:60px"></label> <label>Max Concurrent Requests: <input type="number" id="maxConcurrentRequests" value="${e.maxConcurrentRequests}" style="width:60px"></label> <label>Rate Limit Delay (ms): <input type="number" id="rateLimitDelay" value="${e.rateLimitDelay}" style="width:60px"></label><br><button id="exportJsonBtn">Export JSON</button> <button id="exportCsvBtn">Export CSV</button></div><div id="progressBar" style="width:100%;background:#f2f2f2"><div id="progressBarFill" style="width:0;height:30px;background:#4caf50;text-align:center;color:#fff">0%</div></div><div id="crawlResults"></div><div id="analysisResults"></div><div id="log" style="margin-top:20px;border:1px solid #ddd;padding:10px;height:200px;overflow-y:scroll"></div></div><style>#crawlerUI table{width:100%;border-collapse:collapse;margin-bottom:20px}#crawlerUI th,#crawlerUI td{border:1px solid #ddd;padding:8px;text-align:left}#crawlerUI th{background-color:#f2f2f2}#crawlerUI .thumbnail{width:${e.thumbnailSize}px;height:${e.thumbnailSize}px;object-fit:cover}#crawlerUI .media-icon{display:inline-block;width:${e.thumbnailSize}px;height:${e.thumbnailSize}px;background-color:#ddd;text-align:center;line-height:${e.thumbnailSize}px}</style>`,document.body.appendChild(t),document.getElementById("startCrawlBtn").addEventListener("click",window.startCrawl),document.getElementById("scanCurrentPageBtn").addEventListener("click",window.scanCurrentPage),document.getElementById("togglePauseBtn").addEventListener("click",window.togglePause),document.getElementById("analyzePageBtn").addEventListener("click",window.analyzePage),document.getElementById("filterInput").addEventListener("input",function(){window.setFilter(this.value)}),document.getElementById("maxDepth").addEventListener("change",function(){window.updateConfig("maxDepth",this.value)}),document.getElementById("maxConcurrentRequests").addEventListener("change",function(){window.updateConfig("maxConcurrentRequests",this.value)}),document.getElementById("rateLimitDelay").addEventListener("change",function(){window.updateConfig("rateLimitDelay",this.value)}),document.getElementById("exportJsonBtn").addEventListener("click",function(){window.exportData("json")}),document.getElementById("exportCsvBtn").addEventListener("click",function(){window.exportData("csv")})}()}();
